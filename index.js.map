{"version":3,"file":"index.js","sources":["src/Axios.ts"],"sourcesContent":["import type {\r\n  AxiosError,\r\n  AxiosInstance,\r\n  AxiosPromise,\r\n  AxiosRequestConfig,\r\n  AxiosResponse,\r\n  CancelTokenSource,\r\n} from 'axios';\r\nimport axios from 'axios';\r\nimport type { Subscriber } from 'rxjs';\r\nimport { Observable } from 'rxjs';\r\nimport type { AxiosObservable } from './AxiosObservable';\r\n\r\n\r\ntype Any = any;\r\n\r\n\r\nexport namespace Axios {\r\n  export type RequestInterceptor = (\r\n    config: AxiosRequestConfig,\r\n  ) => AxiosRequestConfig | Promise<AxiosRequestConfig>;\r\n\r\n  export type ResponseInterceptor<T = Any> = (\r\n    response: AxiosResponse<T>,\r\n  ) => AxiosResponse<T> | Promise<AxiosResponse<T>>;\r\n\r\n  export type ErrorInterceptor<T = Any> = (\r\n    error: AxiosError<T>,\r\n  ) => void | Promise<void>;\r\n}\r\n\r\n/**\r\n * @package [react3l-axios-observable](https://www.npmjs.com/package/react3l-axios-observable)\r\n * @namespace Axios\r\n * @author thanhtunguet <thanhtung.uet@gmail.com>\r\n * @description Axios class, like axios, but with observable methods\r\n */\r\nexport class Axios implements Pick<AxiosInstance, 'defaults' | 'interceptors'> {\r\n  /**\r\n   * Axios default config\r\n   *\r\n   * @type {AxiosRequestConfig}\r\n   */\r\n  \r\n  public static defaults: AxiosRequestConfig = axios.defaults;\r\n\r\n  /**\r\n   * Axios interceptor manager\r\n   *\r\n   * @type {AxiosInstance[\"interceptor\"]}\r\n   */\r\n  public static interceptors: AxiosInstance['interceptors'] =\r\n    axios.interceptors;\r\n\r\n  private axiosInstance: AxiosInstance;\r\n\r\n  /**\r\n   * Class constructor\r\n   *\r\n   * @param axiosInstance - Axios instance\r\n   */\r\n  constructor(axiosInstance: AxiosInstance) {\r\n    this.axiosInstance = axiosInstance;\r\n  }\r\n\r\n  public get interceptors(): AxiosInstance['interceptors'] {\r\n    return this.axiosInstance.interceptors;\r\n  }\r\n\r\n  public get defaults(): AxiosInstance['defaults'] {\r\n    return this.axiosInstance.defaults;\r\n  }\r\n\r\n  /**\r\n   * Create a new Axios instance\r\n   * @param config {AxiosRequestConfig}\r\n   */\r\n  public static create(config?: AxiosRequestConfig): Axios {\r\n    const axiosInstance: AxiosInstance = axios.create(config);\r\n    return new Axios(axiosInstance);\r\n  }\r\n\r\n  public static request<T = Any>(\r\n    config: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.request, config);\r\n  }\r\n\r\n  public static get<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.get, url, config);\r\n  }\r\n\r\n  public static delete<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.delete, url, config);\r\n  }\r\n\r\n  public static head<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.head, url, config);\r\n  }\r\n\r\n  public static options<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.options, url, config);\r\n  }\r\n\r\n  public static post<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.post, url, data, config);\r\n  }\r\n\r\n  public static put<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.put, url, data, config);\r\n  }\r\n\r\n  public static patch<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(axios.patch, url, data, config);\r\n  }\r\n\r\n  /**\r\n   * Create an observable function from a promise function\r\n   *\r\n   * @param promiseFunction\r\n   * @param args\r\n   * @private\r\n   */\r\n  private static createObservable<T>(\r\n    promiseFunction: (...args: Any[]) => AxiosPromise<T>,\r\n    ...args: Any[]\r\n  ): AxiosObservable<T> {\r\n    let config: AxiosRequestConfig = args[args.length - 1];\r\n    config = typeof config === 'object' ? { ...config } : {};\r\n    args[args.length - 1] = config;\r\n\r\n    let cancelSource: CancelTokenSource;\r\n    const hasCancelToken = !!config.cancelToken;\r\n    if (hasCancelToken) {\r\n      console.warn(\r\n        `No need to use cancel token, just unsubscribe the subscription would cancel the http request automatically`,\r\n      );\r\n    }\r\n\r\n    return new Observable<AxiosResponse<T>>(\r\n      (subscriber: Subscriber<AxiosResponse<T>>) => {\r\n        if (!hasCancelToken) {\r\n          cancelSource = axios.CancelToken.source();\r\n          config.cancelToken = cancelSource.token;\r\n        }\r\n\r\n        promiseFunction(...args)\r\n          .then((response: any) => {\r\n            subscriber.next(response);\r\n            subscriber.complete();\r\n          })\r\n          .catch((error: AxiosError) => subscriber.error(error));\r\n      },\r\n    );\r\n  }\r\n\r\n  public request<T = Any>(config: AxiosRequestConfig): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.request, config);\r\n  }\r\n\r\n  public get<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.get, url, config);\r\n  }\r\n\r\n  public delete<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.delete, url, config);\r\n  }\r\n\r\n  public head<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.head, url, config);\r\n  }\r\n\r\n  public options<T = Any>(\r\n    url: string,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.options, url, config);\r\n  }\r\n\r\n  public post<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(\r\n      this.axiosInstance.post,\r\n      url,\r\n      data,\r\n      config,\r\n    );\r\n  }\r\n\r\n  public put<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(this.axiosInstance.put, url, data, config);\r\n  }\r\n\r\n  public patch<T = Any>(\r\n    url: string,\r\n    data?: Any,\r\n    config?: AxiosRequestConfig,\r\n  ): AxiosObservable<T> {\r\n    return Axios.createObservable<T>(\r\n      this.axiosInstance.patch,\r\n      url,\r\n      data,\r\n      config,\r\n    );\r\n  }\r\n}\r\n"],"names":["Observable"],"mappings":"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"}